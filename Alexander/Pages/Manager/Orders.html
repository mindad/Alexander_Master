<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Manager Production</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
    <script src="../../Scripts/ajaxCalls.js"></script>

    <script>
        OrderArr = [];

        $(document).ready(function () {

            $('#editDiv').hide();
            $('#submit_edit').on('click', submitEdit);
            $('#editDiv').on('submit', f1);


            ajaxCall("GET", "../../api/Order", "", GetOrderSucess, GetOrderError); //GET ORDER


            buttonEvents();

            //$('#add_new_batchbotteling').on('click', toggle_add_visibilty);

        });
        //Batch_Botteling  API

        function GetOrderSucess(data) {

            console.log('this is OrderArr:', data);

            OrderArr = data;
            console.log(OrderArr);
            try {
                $('#tbl').DataTable({

                    data: data,

                    pageLength: 7,
                    columns: [
                        {
                            data: {},
                            render: function (data, type, row, meta) {

                                let data_for_tbl = "data-btnId='" + data.OrderID + "'";
                                let data_for_tbl1 = "data-btnBeerType='" + data.Beer.BeerType + "'";

                                editBtn = "<button type='button' class = 'editBtn btn btn-success'" + data_for_tbl + data_for_tbl1+ "> Edit </button>";
                                //deleteBtn = "<button type='button' class = 'deleteBtn btn btn-danger'" + data_for_tbl + "> Delete </button>";
                                return editBtn /*+ deleteBtn*/;
                            }
                        },
                        { data: "OrderID" },
                      
                        {
                            data: "Date",
                            render: function (data) {
                                return data.substr(0, 10);
                            }

                        },
                    
                        { data: "Beer.BeerType" },
                        { data: "Beer.Keg20_amount" },
                        { data: "Beer.Keg30_amount" },
                        { data: "Beer.BottleCase_amount" },
                

                     


                    ]
                });
            }

            catch (err) {
                alert(err);
            }

        }

        function GetOrderError(err) {
            console.log(err);
        }

        function toggle_add_visibilty() {
            $('.invisible').removeClass();
        }

        function GetBeerTypes() {
            console.log('in Beer types');
            // implement here ajaxcall that gets all beer types from DB
        }


        function buttonEvents() {

            $(document).on("click", ".editBtn", function () {

                console.log('batch id is:', this.getAttribute('data-btnId'));
                console.log('data-btnBeerType is:', this.getAttribute('data-btnBeerTypee'));

                $('#editDiv').show();

                populateFields(this.getAttribute('data-btnId'), this.getAttribute('data-btnBeerType')); // fill the form fields according to the selected row

            });

            //$(document).on("click", ".deleteBtn", function () {

            //    var batch_id = this.getAttribute('data-btnId');

            //    if (confirm("Are You Sure You Want To Delete This Row?")) {

            //        ajaxCall("Delete", "../../api/Batch_Botteling", JSON.stringify(batch_id), DeleteBatch_BottelingSucess, DeleteBatch_BottelingError);
            //    }
            //    else {
            //        console.log("You pressed Cancel!");
            //    }

            //});
        }
        //////// DeleteBatch
        //function DeleteBatch_BottelingSucess(data) {
        //    console.log(data, "Record Deleted");

        //    location.reload();

        //}

        //function DeleteBatch_BottelingError(err) {
        //    console.log(err);
        //}

        // Edit Batch

        function populateFields(orderID, beertype) {

            let order;

            for (let item of OrderArr) { // find batch_id clicked on in 'Batch_BottelingArr'

                if ((item.OrderID == orderID) && (item.Beer.BeerType == beertype)) {
                    order = item;
                    break;
                }
            }

            console.log('this is order', order);
            ///to continue
            $('#ProdID_header_edit').html('ProdID : ' + prod.ProdID);
            $('#ProdName_header_edit').html('ProdName:' + prod.ProdName);
            $('#amountInput_edit').val(prod.amountInput);
            $('#MinInStockInput_edit').val(prod.MinInStockInput);

        }

        function submitEdit() {


            let product = {
                prodID: $('#ProdID_header_edit').html().replace(/[^0-9]/g, ''), // gets prodID RegEX
                prodName: $('#ProdName_header_edit').html().replace(/^ProdName:/g, ''), // gets prodName  RegEX

                amount: $('#amountInput_edit').val(),
                min_in_stock: $('#MinInStockInput_edit').val(),

            }

            console.log('product to PUT:', product);

            ajaxCall("PUT", "../../api/managerproducts", JSON.stringify(product), Put_success, Put_Error);

            refresh_table();

        }
        // ** Edit Batch

        function Put_success(data) {
            console.log(data);

            return false;
        }

        function Put_Error(err) {
            console.log(err);
        }



        function f1() {
            return false;
        }
        function refresh_table() {
            location.reload();
        }


    </script>

    <style>

        body {
            background-color: #f7f6f6;
            padding-bottom: 1%;
        }

        #headerRow {
            height: 180px;
        }

        .navbar {
            height: 70px;
        }

        table {
            text-align: center;
            margin-right: 200px;
        }

        #addprod {
            text-align: center;
            margin-top: 100px;
        }

        #addprod {
            margin: auto;
            width: 60%;
            border: solid 2px;
            background-color: aliceblue;
        }

        .container {
            padding-bottom: 4%;
        }
    </style>
</head>
<body>
    <!-- NavBar Template -->
    <div class="header text-center">
        <!-- <h2>Manager Dashboard</h2> -->
        <nav class="navbar navbar-expand-sm navbar-light border-bottom" style="background-color: #f7f6f6;">
            <a class="navbar-brand" href="#">Home</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Production</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="#">Boxes</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="#">Labels</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="#">Waste</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="#">Alerts</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="#">Annual Reports</a>
                    </li>
                </ul>
            </div>
            <a class="navbar-brand" href="#">
                <img src="../Images/Logo_alexander.jpeg" height="68" alt="alexander logo">

            </a>
        </nav>
    </div>
    <!-- NavBar Template -->
    <!-- table -->
    <div class="container-fluid">
        <table id="tbl" class="display" border="1" style="width:90%">
            <thead style="background-color:cornflowerblue">
                <tr>
                    <th></th> <!--edit/delete buttons-->
                    <th>Order ID</th>
                    <th>Supply Date</th>
                    <th>Beer Type</th>
                    <th>Kegs 20 Amount</th>
                    <th>Kegs 30 Amount</th>
                    <th>bottles box24</th>

                </tr>
            </thead>
            <tbody></tbody>

        </table>
    </div>
    <!-- table -->
    <!--Edit Row In  Table-->
    <div class="container" id="editDiv">
        <form id="editForm">
            <div class="form-group">

                <h2 id="ProdID_header_edit"></h2><br />
                <h2 id="ProdName_header_edit"></h2><br />
                <label>Amount</label>
                <input type="number" value="" id="amountInput_edit" />
                <br>
                <label>Minimum In Stock</label>
                <input type="number" value="" id="MinInStockInput_edit" />
                <br>

            </div>
            <button id="submit_edit">Submit</button>
        </form>
    </div>
    <!--Edit Row In  Table-->
</body>
</html>