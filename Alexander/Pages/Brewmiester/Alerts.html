<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Brewmiester Production</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!--<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
    <script src="../../Scripts/ajaxCalls.js"></script>



    <script>

        recipeArr = [];
        batchArr = [];

        $(document).ready(function () {

            $('#editDiv').hide();

            //$("#ourForm, #editForm").on('submit', f1);

            buttonEvents();

            ajaxCall("GET", "../../api/Alert", "", GetAlertSucess, GetAlertError); // get all recipes

            //$("#beerSelect").on('change', SetFormValues); // set form values when add batch to table

            //$("#addToBatch").on("click", PostNewBatch);

            $('#submit_edit').on("click", edit_Alert_table);

        });

        // Alert API
        function GetAlertSucess(Alertdata) {

            console.log('this is Alert data:', Alertdata);


            try {
                $('#tbl').DataTable({

                    data: Alertdata,
                    pageLength: 5,
                    columns: [
                        {
                            data:"AlertID",
                            render: function (data, type, row, meta) {

                                let data_for_tbl = "data-btnId='" + data + "'";

                                editBtn = "<button type='button' class = 'editBtn btn btn-success'" + data_for_tbl + "> Edit </button>";
                                deleteBtn = "<button type='button' class = 'deleteBtn btn btn-danger'" + data_for_tbl + "> Delete </button>";
                                return editBtn + deleteBtn;
                            }
                        },
                        { data: "Type" },
                        { data: "Date" },
                        { data: "Description" },
                        { data: "Notes" }
                    ]
                });
            }

            catch (err) {
                alert(err);
            }
        }

        function GetAlertError(err) {
            console.log(err);
        }

        function PostBatchSucess(data) {
            console.log(data);

            $('.collapse').collapse('hide'); // collapse addprodContainer

            alert('Batch Added Succefully');
        }

        function PostBatchError(err) {
            console.log(err);
        }
        // ** Alert API


        function f1() {
            return false;
        }

        //////// edit + delete
        function buttonEvents() {

            $(document).on("click", ".editBtn", function () {

                $("#editDiv").show();
                console.log('alert id is:', this.getAttribute('data-btnId'));

                $('#ph').val(this.getAttribute('data-btnId')); // saves alert ID for later use
            });

            $(document).on("click", ".deleteBtn", function () {

                var alert_id = this.getAttribute('data-btnId');

                if (confirm("Are You Sure You Want To Delete This Row?")) {

                    ajaxCall("Delete", "../../api/Alert", JSON.stringify(alert_id), DeleteAlertSucess, DeleteAlertError);
                }
                else {
                    console.log("You pressed Cancel!");
                }

            });
        }

        function edit_Alert_table() {

            let alert_id_and_notes = {
                id: $('#ph').val(),
                notes: $("#batchDateInput").val()
            }
               
            ajaxCall("PUT", "../../api/Alert", JSON.stringify(alert_id_and_notes), editAlertSucess, editAlertError);
        }

        //////// editAlert
        function editAlertSucess(data) {
            console.log(data, 'record changed succefully');

            refresh_table();

        }
        function editAlertError(err) {
            console.log(err);
        }
        //****** editAlert

        //////// Delete Alert
        function DeleteAlertSucess(data) {
            console.log(data, "Record Deleted");

            refresh_table();

        }

        function DeleteAlertError(err) {
            console.log(err);
        }
        //****** Delete Alert


        //function populateFields(btnID) { // set values in edit DIV

        //    let id_in_arr = 0;
        //    // get row in batchArr
        //    for (i in batchArr) {
        //        if (batchArr[i].BatchID == btnID) {
        //            id_in_arr = i;
        //            break;
        //        }
        //    }

        //    //$('#ph').val(id_in_arr); // saves id for later use

        //    $("#editDiv").show();
        //    $("#beerTypeInput").val(batchArr[id_in_arr].BeerType);
        //    $("#batchDateInput").val(batchArr[id_in_arr].Date.substr(0,10));
        //}

        function refresh_table() {

            $('#tbl').DataTable().destroy(); // destory table so it could be refreshed
            $("#editDiv").hide();

            ajaxCall("GET", "../../api/Alert", "", GetAlertSucess, GetAlertError); // get all Alerts
        }

        function PostNewBatch() {

            //get max batchID
            let ID_arr = [];
            for (var i = 0; i < batchArr.length; i++) {
                ID_arr.push(batchArr[i].BatchID);
            }

            batch = {
                batchID: Math.max.apply(null, ID_arr) + 1,
                date: $('#addDate').val(),
                beerType: $('#beerSelect').val(),
                tank:0,
                wort_volume:0
            }

            console.log('this is batch to post:', batch);


            ajaxCall('POST', "../../api/Alert", JSON.stringify(batch), PostBatchSucess, PostBatchError);
        }

    </script>



    <style>
        body {
            background-color: #f7f6f6;
            padding-bottom: 1%;
        }

        #headerRow {
            height: 180px;
        }

        .navbar {
            height: 70px;
        }

        table {
            text-align: center;
        }

        .container {
            padding-bottom: 4%;
        }
        #notes_input{
            height: 15%;
            width:80%;
        }
    </style>

</head>

<body>
    <!-- NavBar Template -->
    <div class="header text-center">
        <nav class="navbar navbar-expand-lg navbar-light border-bottom" style="background-color: #f7f6f6;">
            <a class="navbar-brand" href="#">Home</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Production</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="#">Inventory</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="#">Waste</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="#">Alerts</a>
                    </li>
                    <!-- <li class="nav-item">
                      <a class="nav-link disabled" href="#">Disabled</a>
                    </li> -->
                </ul>
            </div>
            <a class="navbar-brand" href="#">
                <img src="../Images/Logo_alexander.jpeg" height="68" alt="alexander logo">
            </a>
        </nav>
    </div>
    <br><br>
    <!-- NavBar Template -->
    <!-- table -->
    <div class="container">
        <table id="tbl" class="display" border="1" style="width:100%">
            <thead style="background-color:cornflowerblue">
                <tr>
                    <th></th> <!--edit/delete buttons-->
                    <th>Type</th>
                    <th>Time</th>
                    <th>Description</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
            </tbody>

        </table>
    </div>
    <!-- table -->
    <!--Edit Row In  Table-->
    <div class="container" id="editDiv">
        <form id="editForm">
            <!--<div class="form-group">-->
            <label for="">Add Notes Here:</label>
            <textarea id="notes_input"> </textarea>
            <!--</div>-->
            <button id="submit_edit">Submit</button>
        </form>
    </div>
    <!--Edit Row In  Table-->
    <div id="ph"></div>
</body>

</html>