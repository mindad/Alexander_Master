<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Batch</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
    <script src="../../Scripts/ajaxCalls.js"></script>
    <!--add pdf/print and excel options-->
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.flash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.print.min.js"></script>
    <link href="../CSS/styles.css" rel="stylesheet" />
    <script src="../JS/glob_functions.js"></script>

    <script>

        batch_id = null; // current batch
        sampleArr = [];
        purgeArr = [];
        harvestArr = [];
        fermentArr = [];
        batch = [];


        $(document).ready(function () {

            Check_User("Brewmiester");

            batch_id = decodeURI(document.location.search).replace(/[^0-9]/g, '');
            $("#headerline").html(`Batch # ${batch_id}`);

            hideDivs(); // Hide ADD & Edit Divs

            // APIs
            ajaxCall('GET', '../../api/Batch_Production', '', GetBatchSuccess, GetBatchError); // check if exist and bring values into tables
            ajaxCall('GET', '../../api/SampleDetails', '', GetSampleSuccess, GetSampleError);// tbl-sample
            ajaxCall('GET', '../../api/Purge', '', GetPurgeSuccess, GetPurgeError); //tbl-purge
            ajaxCall('GET', '../../api/Harvest', '', GetHarvestSuccess, GetHarvestError); //tbl-harvest
            ajaxCall('GET', '../../api/Fermantation', '', GetFermantationSuccess, GetFermantationError); //tbl-Fermant

            buttonEvents(); // edit + delete buttons

            // edit forms submit
            $("#editForm_sample").on("submit", EditSample);
            $("#editForm_purge").on("submit", EditPurge);
            $("#editForm_harvest").on("submit", EditHarvest);
            $("#editForm_ferment").on("submit", EditFerment);
            $("#editForm_batch").on("submit", EditBatch);

            // Show Forms e
            $("#AddSample").on("click", showSample);
            $("#AddPurge").on("click", showPurge);
            $("#AddHarvest").on("click", showHarvest);
            $("#AddFermantation").on("click", showFermantation);

            // Submit Form e
            $("#addForm_sample").on("submit", AddSample);
            $("#addForm_purge").on("submit", AddPurge);
            $("#addForm_harvest").on("submit", AddHarvest);
            $("#addForm_ferment").on("submit", AddFermantation);

            // Table Buttons
            $("#sampleBtn").on("click", function () { $(`#sample_div`).toggle();});
            $("#purgeBtn").on("click", function () { $(`#purge_div`).toggle();} );
            $("#harvestBtn").on("click", function () { $(`#harvest_div`).toggle();} );
            $("#fermentBtn").on("click", function () { $(`#fermant_div`).toggle();} );

            // Close button logic
            $(".close_Btn").on("click", Close_Edit_Div);
            $(".close_Btn_batch").on("click", Close_edit_batch);

            Hide_Tables('');

            setInterval(function () { checkExpiration_Brewmiester(); }, 15 * 60 * 1000); // 15 min Interval for user expiration
        });


        // Batch API
        function GetBatchSuccess(data) {
            console.log('Batch At Production Data:', data);

            batch = [];

            for (let bt of data) {
                if (batch_id == bt.BatchID) {
                    batch.push(bt);
                    break;
                }
            }

            console.log("This is chosen batch", batch);

            try {
                $('#tbl-BatchAtProd').DataTable({
                    "paging": false,
                    "ordering": false,
                    "info": false,
                    "searching": false,
                    data: batch,
                    pageLength: 2,
                    columns: [
                        {
                            data: "BatchID", 
                            render: function () {
                                editBtn = "<button type='button' class = 'editbtAtProdBtn btn btn-success'> Edit </button>";
                                return editBtn;
                            }
                        },
                        { data: "Cast_volume" },
                        { data: "Yeast_cycle" },
                        { data: "Co2_vol" },
                        { data: "PitchTime" },
                        { data: "Og" },
                        { data: "Fg" },
                        { data: "Pitching_rate" },
                        { data: "Tank_temp" },
                        { data: "Set_temp" }
                    ]
                });
            }

            catch (err) {
                alert(err);
            }
            
        }


        function GetBatchError(err) {
            console.log(err);
        }
        // ** Batch API

        // Sample API
        function GetSampleSuccess(samples) {
            console.log('sample Details:', samples);

            for (let sample of samples) {
                if (sample.Batch_id == batch_id) {
                    sampleArr.push(sample);
                }
            }

            console.log('this is sampleArr:', sampleArr);

            try {
                $('#tbl-sample').DataTable({
                    "paging": false,
                    "ordering": false,
                    "info": false,
                    "searching": false,
                    dom: 'Bfrtip',
                    buttons: ['excel', 'pdf', 'print'],
                    data: sampleArr,
                    pageLength: 5,
                    columns: [
                        {
                            data: "Row_num", // row in DB
                            render: function (data) {

                                let data_for_tbl = "data-Sample-btnId='" + data + "'";

                                editBtn = "<button type='button' class = 'editSampleBtn btn btn-success'" + data_for_tbl + "> Edit </button>";
                                deleteBtn = "<button type='button' class = 'deleteSampleBtn btn btn-danger'" + data_for_tbl + "> Delete </button>";
                                return editBtn + deleteBtn;
                            }
                        },
                        {
                            data: "Date",
                            render: function (data) {
                                return data.substr(0, 10);
                            }
                        },
                        { data: "Tank_temp" },
                        { data: "Sample_temp" },
                        { data: "Rate" },
                        { data: "Gravity" },
                        { data: "Ph" },
                        { data: "Notes" },
                    ]
                });
            }

            catch (err) {
                alert(err);
            }

        }
        function GetSampleError(err) {
            console.log(err);
        }

        function PutSampleSuccess(data) {
            console.log(data);

            refresh_table();
        }
        function PutSampleError(err) {
            console.log(err);
        }

        function showSample() {

            Hide_Tables("sample"); // hide all tables but sample
            $("#addDiv_sample").show();
        }

        function AddSample() {

            let item = {
                "date": $("#addDateSample").val(),
                "tank_temp": $("#addtankTemp").val(),
                "sample_temp": $("#addsampleTemp").val(),
                "rate": $("#addrate").val(),
                "gravity": $("#addgravity").val(),
                "ph": $("#addPH").val(),
                "notes": $("#addnotesSample").val(),
                "batch_id": batch_id
            }

            console.log("this is item to POST", item);

            ajaxCall("POST", "../../api/SampleDetails", JSON.stringify(item), postSampleSuccess, postSampleError);

            return false;
        }

        function postSampleSuccess(data) {
            console.log(data);
            refresh_table();
        }
        function postSampleError(err) {
            console.log(err);
        }
        // ** Sample API

        // Purge API
        function GetPurgeSuccess(purges) {
            console.log('purges:', purges);


            //let prg = [];

            for (let purge of purges) {
                if (purge.Batchid == batch_id) {
                    purgeArr.push(purge);
                }
            }

            console.log('this is purgeArr:', purgeArr);


            try {
                $('#tbl-purge').DataTable({
                    "paging": false,
                    "ordering": false,
                    "info": false,
                    "searching": false,
                    dom: 'Bfrtip',
                    buttons: [
                        'excel', 'pdf', 'print'
                    ],
                    data: purgeArr,
                    pageLength: 5,
                    columns: [
                        {
                            data: "Row_num",
                            render: function (data, type, row, meta) {

                                let data_for_tbl = "data-Purge-btnId='" + data + "'";

                                editBtn = "<button type='button' class = 'editPurgeBtn btn btn-success'" + data_for_tbl + "> Edit </button>";
                                deleteBtn = "<button type='button' class = 'deletePurgeBtn btn btn-danger'" + data_for_tbl + "> Delete </button>";
                                return editBtn + deleteBtn;
                            }
                        },
                        {
                            data: "Date",
                            render: function (data) {
                                return data.substr(0, 10);
                            }
                        },
                        { data: "Name" },
                        { data: "Temperature" },
                        { data: "Weight" },
                        { data: "Num_of_buckets" },
                        { data: "Notes" },
                    ]
                });
            }

            catch (err) {
                alert(err);
            }

        }
        function GetPurgeError(err) {
            console.log(err);
        }

        function PutPurgeSuccess(data) {
            console.log(data);

            refresh_table();
        }
        function PutPurgeError(err) {
            console.log(err);
        }

        function showPurge() {

            Hide_Tables("purge"); // hide all tables but sample
            $("#addDiv_purge").show();
        }

        function AddPurge() {

            let item = {
                "date": $("#addDatePurge").val(),
                "name": $("#addnamePurge").val(),
                "temperature": $("#addtemperaturePurge").val(),
                "weight": $("#addweight").val(),
                "num_of_buckets": $("#addbuckets").val(),
                "notes": $("#addnotesPurge").val(),
                "batchid": batch_id
            }

            console.log("this is item to POST", item);

            ajaxCall("POST", "../../api/Purge", JSON.stringify(item), postPurgeSuccess, postPurgeError);

            return false;
        }

        function postPurgeSuccess(data) {
            console.log(data);
            refresh_table();
        }
        function postPurgeError(err) {
            console.log(err);
        }
        // ** Purge API


        // Harvest API
        function GetHarvestSuccess(harvests) {
            console.log('Harvests:', harvests);

            //let harvest = [];

            for (let hr of harvests) {
                if (hr.Batchid == batch_id) {
                    harvestArr.push(hr);
                }
            }

            console.log('this is harvestArr:', harvestArr);


            try {
                $('#tbl-harvest').DataTable({
                    "paging": false,
                    "ordering": false,
                    "info": false,
                    "searching": false,
                    dom: 'Bfrtip',
                    buttons: [
                        'excel', 'pdf', 'print'
                    ],
                    data: harvestArr,
                    pageLength: 5,
                    columns: [
                        {
                            data: "Row_num",
                            render: function (data, type, row, meta) {

                                let data_for_tbl = "data-Harvest-btnId='" + data + "'";

                                editBtn = "<button type='button' class = 'editHarvestBtn btn btn-success'" + data_for_tbl + "> Edit </button>";
                                deleteBtn = "<button type='button' class = 'deleteHarvestBtn btn btn-danger'" + data_for_tbl + "> Delete </button>";
                                return editBtn + deleteBtn;
                            }
                        },
                        {
                            data: "Date",
                            render: function (data) {
                                return data.substr(0, 10);
                            }
                        },
                        { data: "Name" },
                        { data: "Temperature" },
                        {
                            data: "Time_tap_2",
                            render: function (data) {
                                return data.substr(0, 10);
                            }
                        },
                        {
                            data: "Total_Duration",
                            render: function (data) {
                                return data.substr(0, 10);
                            }
                        },
                    ]
                });
            }

            catch (err) {
                alert(err);
            }

        }
        function GetHarvestError(err) {
            console.log(err);
        }

        function PutHarvestSuccess(data) {
            console.log(data);

            refresh_table();
        }
        function PutHarvestError(err) {
            console.log(err);
        }

        function showHarvest() {

            Hide_Tables("harvest"); // hide all tables but sample
            $("#addDiv_harvest").show();
        }

        function AddHarvest() {

            let item = {
                "date": $("#addDateHarvest").val(),
                "name": $("#addnameHarvest").val(),
                "temperature": $("#addtemperatureHarvest").val(),
                "time_tap_2": $("#addtimeTap").val(),
                "total_Duration": $("#addtotalTime").val(),
                "batchid": batch_id
            }

            console.log("this is item to POST", item);

            ajaxCall("POST", "../../api/Harvest", JSON.stringify(item), postHarvestSuccess, postHarvestError);

            return false;
        }

        function postHarvestSuccess(data) {
            console.log(data);
            refresh_table();
        }
        function postHarvestError(err) {
            console.log(err);
        }
        // ** Harvest API

        // Fermantation API
        function GetFermantationSuccess(Fermantation) {
            console.log('Fermantation:', Fermantation);


            for (let fr of Fermantation) {
                if (fr.Batchid == batch_id) {
                    fermentArr.push(fr);
                }
            }

            console.log('this is fermentArr:', fermentArr);


            try {
                $('#tbl-Fermant').DataTable({
                    "paging": false,
                    "ordering": false,
                    "info": false,
                    "searching": false,
                    dom: 'Bfrtip',
                    buttons: [
                        'excel', 'pdf', 'print'
                    ],
                    data: fermentArr,
                    pageLength: 5,
                    columns: [
                        {
                            data: "Row_num",
                            render: function (data, type, row, meta) {

                                let data_for_tbl = "data-Fermantation-btnId='" + data + "'";

                                editBtn = "<button type='button' class = 'editFermantationBtn btn btn-success'" + data_for_tbl + "> Edit </button>";
                                deleteBtn = "<button type='button' class = 'deleteFermantationBtn btn btn-danger'" + data_for_tbl + "> Delete </button>";
                                return editBtn + deleteBtn;
                            }
                        },
                        {
                            data: "Date",
                            render: function (data) {
                                return data.substr(0, 10);
                            }
                        },
                        { data: "PressureChange" },
                        { data: "Tank_pressure" },
                        { data: "Tank_temperature" },
                        { data: "Ferment" }
                    ]
                });
            }

            catch (err) {
                alert(err);
            }
        }

        function GetFermantationError(err) {
            console.log(err);
        }

        function PutFermantationSuccess(data) {
            console.log(data);

            refresh_table();
        }
        function PutFermantationError(err) {
            console.log(err);
        }

        function showFermantation() {

            Hide_Tables("fermant"); // hide all tables but sample
            $("#addDiv_ferment").show();
        }

        function AddFermantation() {

            let item = {
                "date": $("#addDateFerment").val(),
                "pressureChange": $("#addpressChange").val(),
                "tank_pressure": $("#addtankPress").val(),
                "tank_temperature": $("#addtankTempFerment").val(),
                "ferment": $("#addferment").val(),
                "batchid": batch_id
            }

            console.log("this is item to POST", item);

            ajaxCall("POST", "../../api/Fermantation", JSON.stringify(item), postFermantationSuccess, postFermantationError);

            return false;
        }

        function postFermantationSuccess(data) {
            console.log(data);
            refresh_table();
        }
        function postFermantationError(err) {
            console.log(err);
        }
        // ** Fermantation API


        // Global Functions


        //////// edit + delete
        function buttonEvents() {

            $(document).on("click", ".editSampleBtn,.editHarvestBtn,.editPurgeBtn,.editFermantationBtn", function () {

                let tbl_name = $(this).attr('class').replace(/^edit/, '').replace(/Btn.+/, '');

                Edit_Row_In_TBL(this.getAttribute(`data-${tbl_name.toLowerCase()}-btnid`), tbl_name.toLowerCase());
            });

            $(document).on("click", ".deleteSampleBtn,.deleteHarvestBtn,.deletePurgeBtn,.deleteFermantationBtn", function () {

                let tbl_name = $(this).attr('class').replace(/^delete/, '').replace(/Btn.+/, '');
                console.log("tbl_name is:", tbl_name);

                Delete_Row_In_TBL(this.getAttribute(`data-${tbl_name.toLowerCase()}-btnid`), tbl_name.toLowerCase());

            });

            //
            $(document).on("click", ".editbtAtProdBtn", function () {

                $("#btnContainer").hide();
                Hide_Tables('');
                $("#editDiv_sample").hide();
                $("#editDiv_purge").hide();
                $("#editDiv_harvest").hide();
                $("#editDiv_ferment").hide();
                $("#addDiv_sample").hide();
                $("#addDiv_purge").hide();
                $("#addDiv_harvest").hide();
                $("#addDiv_ferment").hide();
                $("#edit_batch").show();

                $("#castVol").val();
                $("#yeastCycle").val();
                $("#co2Vol").val();
                $("#pitchTime").val();
                $("#og").val();
                $("#fg").val();
                $("#pitchRate").val();
                $("#tankTemp").val();
                $("#setTemp").val();
            });

        }

        function Edit_Row_In_TBL(row_id, tbl_name) {

            console.log('row_id:', row_id);

            Hide_Tables(tbl_name);

            if (tbl_name == "sample") {

                for (var i = 0; i < sampleArr.length; i++) {
                    if (sampleArr[i].Row_num == row_id) {

                        $("#DateSample").val(sampleArr[i].Date.substr(0, 10));
                        $("#tankTemp").val(sampleArr[i].Tank_temp);
                        $("#sampleTemp").val(sampleArr[i].Sample_temp);
                        $("#rate").val(sampleArr[i].Rate);
                        $("#gravity").val(sampleArr[i].Gravity);
                        $("#PH").val(sampleArr[i].Ph);
                        $("#notesSample").val(sampleArr[i].Notes);
                        $("#ph").val(sampleArr[i].Row_num);
                        $("#editDiv_sample").show();
                        break;
                    }
                }
            }
            if (tbl_name == "purge") {

                for (var i = 0; i < purgeArr.length; i++) {
                    if (purgeArr[i].Row_num == row_id) {

                        $("#DatePurge").val(purgeArr[i].Date.substr(0, 10));
                        $("#namePurge").val(purgeArr[i].Name);
                        $("#temperaturePurge").val(purgeArr[i].Temperature);
                        $("#weight").val(purgeArr[i].Weight);
                        $("#buckets").val(purgeArr[i].Num_of_buckets);
                        $("#notesSample").val(purgeArr[i].Notes);
                        $("#ph").val(purgeArr[i].Row_num);
                        $("#editDiv_purge").show()
                        break;
                    }
                }
            }
            if (tbl_name == "harvest") {

                for (var i = 0; i < harvestArr.length; i++) {
                    if (harvestArr[i].Row_num == row_id) {

                        $("#DateHarvest").val(harvestArr[i].Date.substr(0, 10));
                        $("#nameHarvest").val(harvestArr[i].Name);
                        $("#temperatureHarvest").val(harvestArr[i].Temperature);
                        $("#timeTap").val(harvestArr[i].Time_tap_2.substr(0, 10));
                        $("#totalTime").val(harvestArr[i].Total_Duration.substr(0, 10));
                        $("#ph").val(harvestArr[i].Row_num);
                        $("#editDiv_harvest").show();
                        break;
                    }
                }

            }
            if (tbl_name == "fermantation") {

                for (var i = 0; i < fermentArr.length; i++) {
                    if (fermentArr[i].Row_num == row_id) {

                        $("#DateFerment").val(fermentArr[i].Date.substr(0, 10));
                        $("#pressChange").val(fermentArr[i].PressureChange);
                        $("#tankPress").val(fermentArr[i].Tank_pressure);
                        $("#tankTempFerment").val(fermentArr[i].Tank_temperature);
                        $("#ph").val(fermentArr[i].Row_num);
                        $("#ferment").val(fermentArr[i].Ferment);
                        $("#editDiv_ferment").show();
                        break;
                    }
                }
            }

        }

        function Delete_Row_In_TBL(row_id, tbl_name) {

            console.log('row_id:', row_id);

            if (tbl_name == "sample") {

                if (confirm("Are You Sure You Want To Delete This Row?")) {

                    ajaxCall("Delete", "../../api/SampleDetails", JSON.stringify(row_id), DeleteSampleSucess, DeleteSampleError);
                }
                else {
                    alert("You pressed Cancel!");
                }

            }
            if (tbl_name == "purge") {
                if (confirm("Are You Sure You Want To Delete This Row?")) {

                    ajaxCall("Delete", "../../api/Purge", JSON.stringify(row_id), DeletePurgeSucess, DeletePurgeError);
                }
                else {
                    alert("You pressed Cancel!");
                }
            }
            if (tbl_name == "harvest") {
                if (confirm("Are You Sure You Want To Delete This Row?")) {

                    ajaxCall("Delete", "../../api/Harvest", JSON.stringify(row_id), DeleteHarvestSucess, DeleteHarvestError);
                }
                else {
                    alert("You pressed Cancel!");
                }
            }
            if (tbl_name == "fermantation") {
                if (confirm("Are You Sure You Want To Delete This Row?")) {

                    ajaxCall("Delete", "../../api/Fermantation", JSON.stringify(row_id), DeleteFermantationSucess, DeleteFermantationError);
                }
                else {
                    alert("You pressed Cancel!");
                }
            }
        }

        function Hide_Tables(tbl_name) {

            let tbl_list = ['sample_div', 'purge_div', 'harvest_div', 'fermant_div'];

            if (tbl_name != '') {
                let find = tbl_list.indexOf(`${tbl_name}_div`);

                tbl_list.splice(find, 1); // removes tbl_name at index find from list
                return;
            }

            for (tbl of tbl_list) {
                $(`#${tbl}`).hide();
            }

        }

        function Close_Edit_Div() {

            $("#editDiv_sample, #editDiv_purge, #editDiv_harvest, #editDiv_ferment, #addDiv_sample").hide();
            $("#addDiv_purge, #addDiv_harvest, #addDiv_ferment").hide();
            
            let tbl_list = ['sample_div', 'purge_div', 'harvest_div', 'fermant_div'];

            for (tbl of tbl_list) {
                $(`#${tbl}`).hide();
            }
        }



        // EDIT DB
        function EditSample() {

            let item = {
                "date": $("#DateSample").val(),
                "tank_temp": $("#tankTemp").val(),
                "sample_temp": $("#sampleTemp").val(),
                "rate": $("#rate").val(),
                "gravity": $("#gravity").val(),
                "ph": $("#PH").val(),
                "notes": $("#notesSample").val(),
                "batch_id": batch_id,
                "row_num": $("#ph").val()
            }

            console.log("this is item", item);

            ajaxCall("PUT", "../../api/SampleDetails", JSON.stringify(item), PutSampleSuccess, PutSampleError);

            return false;
        }

        function EditPurge() {

            let item = {
                "date": $("#DatePurge").val(),
                "name": $("#namePurge").val(),
                "temperature": $("#temperaturePurge").val(),
                "weight": $("#weight").val(),
                "num_of_buckets": $("#buckets").val(),
                "notes": $("#notesPurge").val(),
                "batch_id": batch_id,
                "row_num": $("#ph").val()
            }

            console.log("this is item", item);

            ajaxCall("PUT", "../../api/Purge", JSON.stringify(item), PutPurgeSuccess, PutPurgeError);

            return false;
        }

        function EditHarvest() {

            let item = {
                "date": $("#DateHarvest").val(),
                "name": $("#nameHarvest").val(),
                "temperature": $("#temperatureHarvest").val(),
                "time_tap_2": $("#timeTap").val(),
                "total_Duration": $("#totalTime").val(),
                "batch_id": batch_id,
                "row_num": $("#ph").val()
            }

            console.log("this is item", item);

            ajaxCall("PUT", "../../api/Harvest", JSON.stringify(item), PutHarvestSuccess, PutHarvestError);

            return false;
        }

        function EditFerment() {

            let item = {
                "date": $("#DateFerment").val(),
                "pressureChange": $("#pressChange").val(),
                "tank_pressure": $("#tankPress").val(),
                "tank_temperature": $("#tankTempFerment").val(),
                "ferment": $("#ferment").val(),
                "batch_id": batch_id,
                "row_num": $("#ph").val()
            }

            console.log("this is item", item);

            ajaxCall("PUT", "../../api/Fermantation", JSON.stringify(item), PutFermantationSuccess, PutFermantationError);

            return false;
        }

        function EditBatch() {
            let item = {
                "batchID": batch_id,
                "cast_volume": $("#castVol").val(),
                "yeast_cycle": $("#yeastCycle").val(),
                "co2_vol": $("#co2Vol").val(),
                "pitchTime": $("#pitchTime").val(),
                "og": $("#og").val(),
                "fg": $("#fg").val(),
                "pitching_rate": $("#pitchRate").val(),
                "tank_temp": $("#tankTemp").val(),
                "set_temp": $("#setTemp").val()
            }

            console.log("this is item", item);

            ajaxCall("PUT", "../../api/Batch_Production", JSON.stringify(item), PutBatchSuccess, PutBatchError);

            return false;
        }

         function PutBatchSuccess(data) {
             console.log(data);

             $('#edit_batch').hide();

             refresh_table();
        }
        function PutBatchError(err) {
            console.log(err);
        }
        // ****** EDIT DB

        // Delete DB
        function DeleteSampleSucess(data) {
            console.log(data);

            refresh_table();
        }
        function DeleteSampleError(err) {
            console.log(err);
        }

        function DeletePurgeSucess(data) {
            console.log(data);

            refresh_table();
        }
        function DeletePurgeError(err) {
            console.log(err);
        }

        function DeleteHarvestSucess(data) {
            console.log(data);

            refresh_table();
        }
        function DeleteHarvestError(err) {
            console.log(err);
        }

        function DeleteFermantationSucess(data) {
            console.log(data);

            refresh_table();
        }
        function DeleteFermantationError(err) {
            console.log(err);
        }

        // ***** Delete DB


        function hideDivs() {
            $("#editDiv_sample, #editDiv_purge, #editDiv_harvest, #editDiv_ferment, #addDiv_sample").hide();
            $("#addDiv_purge, #addDiv_harvest, #addDiv_ferment, #edit_batch").hide();
        }

        function Close_edit_batch() {
            $("#edit_batch").hide();
            $("#btnContainer").show();
        }

    </script>

    <style>
        .container {
            padding-bottom: 1%;
        }
        /*tbl CSS*/
        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        th,td {
            padding: 5px;
        }
        input[type=text] {
            background-color: #f7f6f6;
        }
        input.form-control[type=text] {
            background-color: #FFFFFF;
        }
        .btn-warning {
            width: 10%;
            border: solid;
        }
        #btnContainer{
            padding-top:2%;
        }
        .detailsBtn{
            width:100%;
            height:100%;
        }
        #edit_batch{
            padding-top:2%;
        }
    </style>

</head>

<body>
    <!-- NavBar Template -->
    <div class="header text-center">
        <nav class="navbar navbar-expand-sm navbar-light border-bottom" style="background-color: #f7f6f6;">
            <a class="navbar-brand" href="Brewmiester-dashboard.html">Home</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="Brewmiester-prod.html">Production</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="Inventory.html">Inventory</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="Recipes.html">Recipes</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="../Waste_transition.html">Waste</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="Alerts.html">Alerts</a>
                    </li>
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="../Login.html" onclick="Clear_LocalStorage()">Exit</a>
                    </li>
                </ul>
            </div>
            <a class="navbar-brand" href="Brewmiester-dashboard.html">
                <img src="../Images/Logo_alexander.jpeg" height="68" alt="alexander logo">
            </a>
        </nav>
    </div>
    <br>
    <!-- NavBar Template -->
    <!-- table - General-->
    <div class="container">
        <h1 class="text-center" id="headerline"></h1><br />
        <table id="tbl-BatchAtProd" class="display" border="1" style="width:100%">
            <thead style="background-color:cornflowerblue">
                <tr>
                    <th></th> <!--edit button-->
                    <th>Cast Volume</th>
                    <th>Yeast Cycle</th>
                    <th>Co2 volume</th>
                    <th>Pitch Time</th>
                    <th>OG</th>
                    <th>FG</th>
                    <th>Pitching Rate</th>
                    <th>Tank Temperature</th>
                    <th>Set Temperature</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <!-- table -->
    <!--Buttons Container-->
    <div class="container" id="btnContainer">
        <div class="row" style="height:200px">
            <div class="col"><button type="button" class="btn-block detailsBtn rounded" id="sampleBtn">Sample Details</button></div>
            <div class="col"><button type="button" class="btn-block detailsBtn rounded" id="purgeBtn">Purge</button></div>
            <div class="col"><button type="button" class="btn-block detailsBtn rounded" id="harvestBtn">Harvest</button></div>
            <div class="col"><button type="button" class="btn-block detailsBtn rounded" id="fermentBtn">Fermantation</button></div>
        </div>
    </div>
    <!--Buttons Container-->
    <!-- table - sample Details-->
    <div class="container" id="sample_div">
        <h5 class="text-center">Sample Details</h5>
        <button id="AddSample" class="btn btn-warning">Add</button>
        <table id="tbl-sample" class="display" border="1" style="width:100%">
            <thead style="background-color:cornflowerblue">
                <tr>
                    <th></th> <!--edit/delete buttons-->
                    <th>Date</th>
                    <th>Tank Temperature</th>
                    <th>Sample Temperature</th>
                    <th>Rate</th>
                    <th>Gravity</th>
                    <th>PH</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <!-- table - sample Details-->
    <!--Purge Table-->
    <div class="container" id="purge_div">
        <h5 class="text-center">Purge</h5>
        <button id="AddPurge" class="btn btn-warning">Add</button>
        <table id="tbl-purge" class="display" border="1" style="width:100%">
            <thead style="background-color:cornflowerblue">
                <tr>
                    <th></th> <!--edit/delete buttons-->
                    <th>Date</th>
                    <th>Name</th>
                    <th>Temperature</th>
                    <th>Weight</th>
                    <th># Of Buckets</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <!--Purge Table-->
    <!--Harvest Table-->
    <div class="container" id="harvest_div">
        <h5 class="text-center" style="margin:auto;">Harvest</h5>
        <button id="AddHarvest" class="btn btn-warning">Add</button>
        <table id="tbl-harvest" class="display" border="1" style="width:100%">
            <thead style="background-color:cornflowerblue">
                <tr>
                    <th></th> <!--edit/delete buttons-->
                    <th>Date</th>
                    <th>Name</th>
                    <th>Temperature</th>
                    <th>Time For Tap 2</th>
                    <th>Total Duration</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <!--Harvest Table-->
    <!--Fermant Table-->
    <div class="container" id="fermant_div">
        <h5 class="text-center">Fermantation</h5>
        <button id="AddFermantation" class="btn btn-warning">Add</button>
        <table id="tbl-Fermant" class="display" border="1" style="width:100%">

            <thead style="background-color:cornflowerblue">
                <tr>
                    <th></th> <!--edit/delete buttons-->
                    <th>Date</th>
                    <th>Pressure Change</th>
                    <th>Tank Pressure</th>
                    <th>Tank Temperature</th>
                    <th>Fermantation</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <!--Fermant Table-->
    <!--Edit Row In A Sample Table-->
    <div class="container" id="editDiv_sample">
        <button type="button" class="close close_Btn" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <form id="editForm_sample">
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-control" id="DateSample" required />
                <br />
                <label>Tank Temperature</label>
                <input type="text" class="form-control" id="tankTemp" pattern="[0-9,\.]+" />
                <br />
                <label>Sample Temperature</label>
                <input type="text" class="form-control" id="sampleTemp" pattern="[0-9,\.]+" />
                <br />
                <label>Rate</label>
                <input type="text" class="form-control" id="rate" pattern="[0-9,\.]+" />
                <br />
                <label>Gravity</label>
                <input type="text" class="form-control" id="gravity" pattern="[0-9,\.]+" />
                <br />
                <label>PH</label>
                <input type="text" class="form-control" id="PH" pattern="[0-9,\.]+" />
                <br />
                <label>Notes</label>
                <input type="text" class="form-control" id="notesSample" />
                <br />
                <div id="btnDiv" class="container">
                    <button type="submit" class="btn btn-primary btn-block">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!--Edit Row In A Sample Table-->
    <!--Edit Row In A Purge Table-->
    <div class="container" id="editDiv_purge">
        <button type="button" class="close close_Btn" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <form id="editForm_purge">
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-control" id="DatePurge" required />
                <br />
                <label>Name</label>
                <input type="text" class="form-control" id="namePurge" required pattern="[0-9a-zA-Z]+" />
                <br />
                <label>Temperature</label>
                <input type="text" class="form-control" id="temperaturePurge" pattern="[0-9,\.]+" />
                <br />
                <label>Weight</label>
                <input type="text" class="form-control" id="weight" pattern="[0-9,\.]+" />
                <br />
                <label># Of Buckets</label>
                <input type="text" class="form-control" id="buckets" pattern="[0-9,\.]+" />
                <br />
                <label>Notes</label>
                <input type="text" class="form-control" id="notesPurge" />
                <br />
                <div id="btnDiv" class="container">
                    <button type="submit" class="btn btn-primary btn-block">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!--Edit Row In A Purge Table-->
    <!--Edit Row In A Harvest Table-->
    <div class="container" id="editDiv_harvest">
        <button type="button" class="close close_Btn" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <form id="editForm_harvest">
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-control" id="DateHarvest" required />
                <br />
                <label>Name</label>
                <input type="text" class="form-control" id="nameHarvest" required pattern="[0-9a-zA-Z]+" />
                <br />
                <label>Temperature</label>
                <input type="text" class="form-control" id="temperatureHarvest" pattern="[0-9,\.]+" />
                <br />
                <label>Time For Tap 2</label>
                <input type="date" class="form-control" id="timeTap" />
                <br />
                <label>Total Duration</label>
                <input type="date" class="form-control" id="totalTime" />
                <br />
                <div id="btnDiv" class="container">
                    <button type="submit" class="btn btn-primary btn-block">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!--Edit Row In A Harvest Table-->
    <!--Edit Row In A Fermantation Table-->
    <div class="container" id="editDiv_ferment">
        <button type="button" class="close close_Btn" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <form id="editForm_ferment">
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-control" id="DateFerment" required />
                <br />
                <label>Pressure Change</label>
                <input type="text" class="form-control" id="pressChange" pattern="[0-9,\.]+" />
                <br />
                <label>Tank Pressure</label>
                <input type="text" class="form-control" id="tankPress" pattern="[0-9,\.]+" />
                <br />
                <label>Tank Temperature</label>
                <input type="text" class="form-control" id="tankTempFerment" pattern="[0-9,\.]+" />
                <br />
                <label>Fermantation</label>
                <input type="text" class="form-control" id="ferment" pattern="[0-9,\.]+" />
                <br />
                <div id="btnDiv" class="container">
                    <button type="submit" class="btn btn-primary btn-block">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!--Edit Row In A Fermantation Table-->
    <div id="ph" hidden></div>
    <!--Add Row In A Sample Table-->
    <div class="container" id="addDiv_sample">
        <button type="button" class="close close_Btn" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <form id="addForm_sample">
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-control" id="addDateSample" required />
                <br />
                <label>Tank Temperature</label>
                <input type="text" class="form-control" id="addtankTemp" pattern="[0-9,\.]+" />
                <br />
                <label>Sample Temperature</label>
                <input type="text" class="form-control" id="addsampleTemp" pattern="[0-9,\.]+" />
                <br />
                <label>Rate</label>
                <input type="text" class="form-control" id="addrate" pattern="[0-9,\.]+" />
                <br />
                <label>Gravity</label>
                <input type="text" class="form-control" id="addgravity" pattern="[0-9,\.]+" />
                <br />
                <label>PH</label>
                <input type="text" class="form-control" id="addPH" pattern="[0-9,\.]+" />
                <br />
                <label>Notes</label>
                <input type="text" class="form-control" id="addnotesSample" />
                <br />
                <div id="btnDiv" class="container">
                    <button type="submit" class="btn btn-primary btn-block">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!--Add Row In A Sample Table-->
    <!--Add Row In A Purge Table-->
    <div class="container" id="addDiv_purge">
        <button type="button" class="close close_Btn" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <form id="addForm_purge">
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-control" id="addDatePurge" required />
                <br />
                <label>Name</label>
                <input type="text" class="form-control" id="addnamePurge" required pattern="[0-9a-zA-Z]+" />
                <br />
                <label>Temperature</label>
                <input type="text" class="form-control" id="addtemperaturePurge" pattern="[0-9,\.]+" />
                <br />
                <label>Weight</label>
                <input type="text" class="form-control" id="addweight" pattern="[0-9,\.]+" />
                <br />
                <label># Of Buckets</label>
                <input type="text" class="form-control" id="addbuckets" pattern="[0-9,\.]+" />
                <br />
                <label>Notes</label>
                <input type="text" class="form-control" id="addnotesPurge" />
                <br />
                <div id="btnDiv" class="container">
                    <button type="submit" class="btn btn-primary btn-block">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!--Add Row In A Purge Table-->
    <!--Add Row In A Harvest Table-->
    <div class="container" id="addDiv_harvest">
        <button type="button" class="close close_Btn" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <form id="addForm_harvest">
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-control" id="addDateHarvest" required />
                <br />
                <label>Name</label>
                <input type="text" class="form-control" id="addnameHarvest" required pattern="[0-9a-zA-Z]+" />
                <br />
                <label>Temperature</label>
                <input type="text" class="form-control" id="addtemperatureHarvest" pattern="[0-9,\.]+" />
                <br />
                <label>Time For Tap 2</label>
                <input type="date" class="form-control" id="addtimeTap" />
                <br />
                <label>Total Duration</label>
                <input type="date" class="form-control" id="addtotalTime" />
                <br />
                <div id="btnDiv" class="container">
                    <button type="submit" class="btn btn-primary btn-block">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!--Add Row In A Harvest Table-->
    <!--Add Row In A Fermantation Table-->
    <div class="container" id="addDiv_ferment">
        <button type="button" class="close close_Btn" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <form id="addForm_ferment">
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-control" id="addDateFerment" required />
                <br />
                <label>Pressure Change</label>
                <input type="text" class="form-control" id="addpressChange" pattern="[0-9,\.]+" />
                <br />
                <label>Tank Pressure</label>
                <input type="text" class="form-control" id="addtankPress" pattern="[0-9,\.]+" />
                <br />
                <label>Tank Temperature</label>
                <input type="text" class="form-control" id="addtankTempFerment" pattern="[0-9,\.]+" />
                <br />
                <label>Fermantation</label>
                <input type="text" class="form-control" id="addferment" pattern="[0-9,\.]+" />
                <br />
                <div id="btnDiv" class="container">
                    <button type="submit" class="btn btn-primary btn-block">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!--Add Row In A Fermantation Table-->
    <!--Edit Batch-->
    <div class="container" id="edit_batch">
        <button type="button" class="close close_Btn_batch" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <form id="editForm_batch">
            <div class="form-group">
                <div class="row">
                    <div class="col">
                        <label>Cast Volume</label>
                        <input type="text" min="0" class="form-control" id="castVol" required pattern="[0-9,\.]+" />
                    </div>
                    <div class="col">
                        <label>Yeast Cycle</label>
                        <input type="number" min="0" class="form-control" id="yeastCycle" required />
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label>Co2 Volume</label>
                        <input type="text" min="0" class="form-control" id="co2Vol" required pattern="[0-9,\.]+" />
                    </div>
                    <div class="col">
                        <label>Pitch Time</label>
                        <input type="text" class="form-control" id="pitchTime" required pattern="[0-9]{2}.[0-9]{2}.[0-9]{2}" />
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label>OG</label>
                        <input type="text" min="0" class="form-control" id="og" required pattern="[0-9,\.]+" />
                    </div>
                    <div class="col">
                        <label>FG</label>
                        <input type="text" min="0" class="form-control" id="fg" required pattern="[0-9,\.]+" />
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label>Pitching Rate</label>
                        <input type="text" min="0" class="form-control" id="pitchRate" required pattern="[0-9,\.]+" />
                    </div>
                    <div class="col">
                        <label>Tank Temperature</label>
                        <input type="text" min="0" class="form-control" id="tankTemp" required pattern="[0-9,\.]+" />
                    </div>
                </div>
                <div class="row">
                    <label>Set Temperature</label>
                    <input type="text" min="0" class="form-control" id="setTemp" required pattern="[0-9,\.]+" />
                </div>

                <div id="btnDiv" class="container">
                    <button type="submit" class="btn btn-primary btn-block">Submit</button>
                </div>
            </div>
        </form>
    </div>
</body>

</html>